<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Project</title>
      <script type="text/javascript" src="js/processing.js"></script>
  </head>
  
  <body>
    <h1>Flappy Danny</h1>
    <p>Survive...</p>
    
    <script type="text/processing">
    
      PImage bg, danny, topPipe, botPipe;
      int bgx, bgy, dx, dy, g, Vdy;
      int[] pipeX, pipeY;
      int gameState, score;

      void setup()
      {
        size(800,600);
        bg = loadImage("./img/bg.png");
        danny = loadImage("./img/danny.png");
        botPipe = loadImage("./img/pipe.png");
        topPipe = loadImage("./img/topPipe.png");
        dx = 100;
        dy = 50;
        g = 1;//Gravity variable, which is the speed of downward acceleration
        pipeX = new int[5];//[0,0,0,0,0]
        pipeY = new int[pipeX.length];
         //POPULATE THE ARRAY
        for(int i = 0; i < pipeX.length; i++)
        {
          pipeX[i] = width + 200*i;
          pipeY[i] = (int)random(-370,0);
        }
      }
      //MAIN GAME LOOP
      void draw()
      {
        if(gameState==0)
        {
        setBg();
        setPipes();
        danny();
        score();
        }
        else
        {
          fill(255);
          text("YOU LOSE", 20,100);
        }

      }

      void score()
      {
        fill(0);
        textSize(32);
        text("Score: " + score, width -170, 40);
      }


      void setPipes()
      {
        for(int i = 0; i < pipeX.length; i++)
        {
        image(topPipe, pipeX[i], pipeY[i]);
        image(botPipe, pipeX[i], pipeY[i] + 680);
        pipeX[i]-= 2;
        if(pipeX[i] < -200)
        {
          pipeX[i] = width;
        }
        if(dx > (pipeX[i]-49) && dx < pipeX[i] + 100)
        {
          if(!(dy > pipeY[i] + 430 && dy < pipeY[i] + (430 + 250-45)))
          {
          gameState = 1;
          }
          else if (dx==pipeX[i])
          {
            score ++;
          }
        }
        }
      }

      void danny()
      {
        image(danny, dx, dy);
        dy = dy + Vdy;
        Vdy = Vdy + g;
        if(dy > height || dy < 0)
          {
            text("YOU LOSE!", 40 , 34);
            gameState=1;
          }
      }

      void setBg()
      {
         image(bg,bgx,bgy);
         image(bg, bgx + bg.width, bgy);
         bgx = bgx - 1;
         if(bgx < -bg.width)
         {
           bgx = 0;
         }
      }

      void mousePressed()
      {
        Vdy = -15;
      }
    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
